---
import Layout from "@/layouts/Layout.astro";
import ProductCard from "@/components/ProductCard.astro";
import ProductDetails from "@/components/ProductDetails.astro";
import { db, products } from "astro:db";
import Footer from "@/components/Footer.astro";


const $products = await db.select().from(products);

function shuffle(array) {
  let currentIndex = array.length, randomIndex;

  while (currentIndex != 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;

    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]
    ];
  }

  return array;
}

export async function getStaticPaths() {
  const $products = await db.select().from(products);
  const paths = $products.map((product) => ({
    params: { id: product.id },
  }));
  return paths;
}

const { id } = Astro.params;

const product = $products.find((product) => product.id === id);
---


<Layout title="Detalles del Producto" className="pt-[64px]">
  <header class="w-full  text-primary font-semibold text-3xl p-4 text-center">
    <h1>Nice Store</h1>
  </header>
  <main class="flex justify-center gap-8 w-full mt-10">
    <ProductDetails product={product} />

    <aside class="hidden md:flex flex-wrap max-w-[500px] gap-8">
      {
       $products.map((product, index) => (
          <ProductCard
            key={index}
            id={product.id}
            name={product.name}
            price={product.price}
          />
        ))
      }
    </aside>
  </main>
  <Footer />
</Layout>
