---
import Layout from "@/layouts/Layout.astro";
import ProductCard from "@/components/Cards/ProductCard.astro";
import ProductDetails from "@/components/Cards/ProductDetails.astro";
import Footer from "@/components/Footer.astro";
import { db, products } from "astro:db";
import Kart from "@/components/Cart.svelte";

const $products = await db.select().from(products);

export async function getStaticPaths() {
  const $products = await db.select().from(products);
  const paths = $products.map((product) => ({
    params: { id: product.id },
  }));
  return paths;
}
export const prerender = true;

const { id } = Astro.params;
const product = $products.find((product) => product.id === id);
---

<Layout title="Detalles del Producto" className="pt-[64px]">
  <header class="w-full text-primary font-semibold text-3xl p-4 my-5 text-center">
    <h2><a href="/tienda">Nice Store</a><Kart client:idle /></h2>
  </header>
  <main class="flex justify-center gap-8 w-full">
    {
      product ? (
        <ProductDetails product={product} />
      ) : (
        <p>Producto no encontrado</p>
      )
    }

    <aside class="hidden md:block h-[700px] overflow-y-scroll">
      <h3 class="text-2xl font-bold text-gray-500 my-2">
        Productos Recomendados
      </h3>
      <div class="h-full flex flex-col gap-8 px-2">
        {
          $products.map((product, index) => (
            <ProductCard
              key={index}
              id={product.id}
              name={product.name}
              price={product.price}
            />
          ))
        }
      </div>
    </aside>
  </main>
  <Footer />
</Layout>
